VIEW ANTIGA, COM CTB
SELECT X.RECEITA AS RECEITA, X.FONTERECURSO AS FONTERECURSO, SUM(X.REALREC) AS REALREC, SUM(X.REALCTB) AS REALCTB, SUM( X.REALBALANCETE) AS REALBALANCETE
        FROM (
        SELECT USUARIO, ANO, SEQ4 as RECEITA , SEQ5 as FONTERECURSO,SUM(CAST(REPLACE(SEQ12, ',', '.') AS NUMERIC) - CAST(REPLACE(SEQ11, ',', '.') AS NUMERIC)) AS REALBALANCETE, 0 as REALREC, 0 as REALCTB
        FROM TCE_SICOM 
        WHERE ARQUIVO = 'BALANCETE'
        AND SEQ1 = '31'
        AND SUBSTRING(SEQ2,1,4) LIKE '6212'
        GROUP BY USUARIO, ANO, SEQ4 , SEQ5

        UNION ALL

        SELECT A.USUARIO, A.ANO, A.SEQ6, B.SEQ3, 0, SUM(CAST(REPLACE(B.SEQ11, ',', '.') AS NUMERIC)) AS REALREC, 0
        FROM TCE_SICOM A
        JOIN TCE_SICOM B ON (A.usuario = B.usuario and A.ano = B.ano and A.MODULO = B.MODULO AND A.ARQUIVO = B.ARQUIVO AND A.SEQ2 = B.SEQ2 AND B.SEQ1 = '11')
        WHERE A.ARQUIVO = 'REC'
        AND A.SEQ1 = '10'
        AND A.SEQ5 = ' '
        GROUP BY A.USUARIO, A.ANO, A.SEQ6, B.SEQ3

        UNION ALL

        SELECT USUARIO, ANO, SEQ5, SEQ6, 0, 0, SUM(CAST(REPLACE(SEQ9, ',', '.') AS NUMERIC)) AS REALCTB
        FROM TCE_SICOM
        WHERE ARQUIVO = 'CTB'
        AND SEQ1 = '22'
        AND SEQ4 = ' '
        GROUP BY USUARIO, ANO, SEQ5, SEQ6) X
        WHERE 1=1
        AND X.USUARIO = %s
        AND X.ANO = %s
        GROUP BY X.RECEITA, X.FONTERECURSO
        HAVING SUM( X.REALBALANCETE) != SUM(X.REALREC) or SUM( X.REALBALANCETE)!= SUM(X.REALCTB) or SUM(X.REALREC) != SUM(X.REALCTB)
        ORDER BY X.RECEITA, X.FONTERECURSO






create or replace view VW_buscaDiferencaValoresReceitas_2023 AS
SELECT X.USUARIO, X.ANO, X.RECEITA AS RECEITA, X.FONTERECURSO AS FONTERECURSO, SUM(X.REALREC) AS REALREC, SUM( X.REALBALANCETE) AS REALBALANCETE
FROM (
SELECT USUARIO, ANO, SEQ4 as RECEITA , SEQ5 as FONTERECURSO,SUM(CAST(REPLACE(SEQ12, ',', '.') AS NUMERIC) - CAST(REPLACE(SEQ11, ',', '.') AS NUMERIC)) AS REALBALANCETE, 0 as REALREC
FROM TCE_SICOM 
WHERE ARQUIVO = 'BALANCETE'
AND SEQ1 = '31'
AND SUBSTRING(SEQ2,1,4) LIKE '6212'
GROUP BY USUARIO, ANO, SEQ4 , SEQ5

UNION ALL

SELECT A.USUARIO, A.ANO, A.SEQ6, B.SEQ3, 0, SUM(CAST(REPLACE(B.SEQ11, ',', '.') AS NUMERIC)) AS REALREC
FROM TCE_SICOM A
JOIN TCE_SICOM B ON (A.usuario = B.usuario and A.ano = B.ano and A.MODULO = B.MODULO AND A.ARQUIVO = B.ARQUIVO AND A.SEQ2 = B.SEQ2 AND B.SEQ1 = '11')
WHERE A.ARQUIVO = 'REC'
AND A.SEQ1 = '10'
AND A.SEQ5 = ' '
GROUP BY A.USUARIO, A.ANO, A.SEQ6, B.SEQ3

) X
WHERE X.ANO = 2023
GROUP BY X.USUARIO, X.ANO, X.RECEITA, X.FONTERECURSO
HAVING SUM( X.REALBALANCETE) != SUM(X.REALREC)
ORDER BY X.RECEITA, X.FONTERECURSO;